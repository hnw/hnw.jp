<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<link rev="MADE" href="mailto:y@hnw.jp">
<link rel="stylesheet" href="../../css/default.css" type="text/css">
<title>wget tips</title>
</head>
<body bgcolor="#BBBBBB" text="#000000" link="#0000ff"
      vlink="#000000" alink="#ffffff">

<p class="header">
<a href="../../index.html">[home]</a>
<a href="./index.html">[back]</a>
</p>

<hr><!-- ____________________________________________________________ -->

<h1>wget の使い方</h1>

<p class="abstract">
自分がたまに使うけど、よく忘れる機能について。
全然使ったことない人はinfo見てください。
（ここに書いてある内容も、多くは 'Guru Usage' あたりに載ってます）
</p>

<hr><!-- ____________________________________________________________ -->


<h2><a name="wget191">wget 1.9.1 released</a></h2>

<p>
[2004/04/05追記]
</p>

<p>
久々の更新ですが、
気づいたら2003年9月頃にwget 1.9.1が<a href="http://wget.sunsite.dk/"
>出てました</a>。
</p>
<ul>
  <li> POSTオプション追加(--post-data)
  <li> -wなどに小数が使えるようになった
</ul>

<p>
POSTが出来るようになって、ついにcurlに追い付いたみたいです。
wgetの方がcookieを扱うのが少し面倒だけど、
やりたいことは全部できるんじゃないでしょうか。
</p>


<hr><!-- ____________________________________________________________ -->


<h2><a name="wget181">wget 1.8.1 released</a></h2>

<p>
[2001/12/28追記]
</p>

<p>
気づいたらwget 1.8.1が<a href="http://wget.sunsite.dk/"
>出てます</a>。
こんな枯れたソフトをよくhackする気になるもんだわ。感謝。

</p>
<ul>
  <li> 帯域制限オプション追加(--limit-rate)
  <li> 複数のIPを持つホストについて、1個蹴られたら次も試す
</ul>

<p>
最初のはでかい変更ですので、重宝する人も多いのでは。
いまのところ問題なく動いています。
これ以外は、コードのrefineが主なようです。
1.8は結構気になるバグがあったので、捨てましょう。
</p>


<hr><!-- ____________________________________________________________ -->


<h2><a name="wget17">wget 1.7 released</a></h2>

<p>
[2001/09/23追記]
</p>

<p>
気づいたらwget 1.7が<a href="http://sunsite.dk/wget/"
>出てます</a>。もはや死角は殆どないといえます。
POSTができないことくらいか。
</p>
<ul>
  <li> HTTPS対応
  <li> クッキー対応
  <li> HTTP/1.1のkeep-aliveに対応
</ul>



<hr><!-- ____________________________________________________________ -->


<h2><a name="wget16">wget 1.6 released</a></h2>

<p>
[2001/03/31追記]
</p>

<p>
なんか、wget 1.6が<a href="http://sunsite.dk/wget/"
>出てまして</a>、<a href="../../patches/index.html"
>10秒パッチ</a>の内容は、大半が実現されています。
具体的に言うと、
</p>
<ul>
  <li> ?の後ろの//などを/にしなくなった。test.pl?http://hoge/ とかもＯＫ。
  <li> port番号が80のときは、Host:にポート番号を書かなくなった。
  <li> --referer= が新設された。
</ul>



<hr><!-- ____________________________________________________________ -->


<h2><a name="wgetrc">.wgetrc</a></h2>

<p>
	wgetのデフォルトの動作は不便なことも多いので、
	.wgetrcにあれこれ書いて、デフォルトの挙動を変えることができます。
</p>
<ul>
  <li> undocumented だが、コマンドラインオプションだけでなく、
       .wgetrc でも user_agent= で user-agent 文字列を変えられる。
       とりあえずネスケになりすます。
       （稀にIE/ネスケのみ特別扱いするサーバがいるため）
  <li> -r で再帰的に辿るとき、wget はデフォルトで /robots.txt の検査をする。
       大抵のサイトにはこんなファイルを置いていないし、
       第一こいつはブラウザなので（笑）、
       このチェックをやめさせる。</li>
  <li> デフォルトのタイムアウト時間は 900 秒と長いので、
       100 秒くらいにする。
       （適当な数字に設定すれば、重いサーバーからブツを落としきるまでの時間が
       短くなります。小さくしすぎると、
       サーバーに負荷をかける上に却って時間がかかったりします）</li>
  <li> 壁の内側にいる場合は、ftpをpassiveにする。
       （Proxy通さないと出られないとか、proxyを使おうがftpは通らないとか、
       壁もいろいろあるかもしれませんが）</li>
</ul>
<p>
	以上、
</p>
<pre>
user_agent = Mozilla/4.06 [en] (Win95; I)
robots = off
timeout = 100
passive_ftp = on
#http_proxy = http://cache.hnw.jp:8080/
#ftp_proxy = http://cache.hnw.jp:8080/
</pre>

<hr><!-- ____________________________________________________________ -->


<h2><a name="rl0">-r -l0 -np</a></h2>

<p>
        そのURLより下層を再帰的に全部取ってくる指定。
        ./www.geocities.com/Tokyo/Ginza/5432/index.html のような
        ディレクトリ構造で保存をしてくれます。
        下に挙げたオプションと組み合わせると幸せかもしれません。
</p>
<dl>
  <dt> -nH
  <dd> ホスト名のディレクトリを掘らないようにする

  <dt> --cut-dirs=数字
  <dd> ディレクトリをn段掘らなくする。
       まず使わないけど…

</dl>


<hr><!-- ____________________________________________________________ -->

<h2><a name="nc">-nc</a></h2>

<p>
        -rで前に取ったときと同じ場所で使って、
        前とり損ねたものだけ取ってくる指定。
        回線状態が劣悪だったとか、
        気が狂ってC-cを押したとかいうときに、
        前のオプションそのままで-ncをつければOK。
</p>
<p>
        前回取ったファイルが更新されていても
        新たに取りにはいかないので注意が必要。
</p>


<hr><!-- ____________________________________________________________ -->

<h2><a name="k">-k</a></h2>

<p>
        HTMLに含まれる絶対パスを相対パスにする指定。
        -r との組み合わせで使うと、
        リンク先がローカルに保存してあればそのファイルへのリンクになるので、
        ローカルで見るときに便利です。
</p>


<hr><!-- ____________________________________________________________ -->

<h2><a name="H">-H</a></h2>

<p>
        -r 使用時に、よそのホストへのリンクを辿るかどうかの指定
        （デフォルトでは辿りません）。
        これを使うときは、
        世界中のファイルを落とさないよう、細心の注意を払いましょう。
        例えば、次のオプションと組み合わせるなど。
</p>
<dl>
  <dt> -l
  <dd> リンクを再帰的に辿る段数（0を指定すると無制限／デフォルトは5）

  <dt> -Q
  <dd> 落とす最大量を指定
       
  <dt> -D
  <dd> リンクを辿るホストを制限
</dl>



<hr><!-- ____________________________________________________________ -->

<h2><a name="G">-G</a></h2>

<p>
        再帰的にファイル取得する際、指定されたタグについて辿らないようにする指定。
        -G img,body と書いて、HTML中のsrc=で指定された絵を取らない、という技がなかなか有効。
        逆に、-rl1 -k -G a,area で、そのページの絵だけ取ってローカルで見る、なんて技もある。
        （aとareaを除外するだけだと不足してるんだけど、実用上は十分）
</p>


<hr><!-- ____________________________________________________________ -->

<h2><a name="R">-R</a></h2>

<p>
        再帰的にファイル取得する際、
        *.cgi?...を辿ってると無限に同じファイルをダウンロードしたりすることがある。
        こんなときに -R '*.cgi' などとすれば辿らなくなる。
        使いどころによっては非常に便利。
</p>

<hr><!-- ____________________________________________________________ -->

<h2><a name="N">-N</a></h2>

<p>
        前に取ったときと同じ場所で使う。
        新しいものだけ取ってくる。
        ftpでとる際、-r との組み合わせで使うと効果大でしょう。
</p>


<hr><!-- ____________________________________________________________ -->

<h2><a name="c">-c</a></h2>

<p>
        途中まで落としてあるものに対して、以降をpartial getする指定。
</p>
<p>
        よほどへろへろなサーバーじゃない限り使えます。
        もちろんftpでも使えます。
</p>


<hr><!-- ____________________________________________________________ -->

<h2><a name="O">-O-</a></h2>

<p>
        GETしたブツを標準出力に出す指定。
</p>
<p>
        他にも、レスポンスヘッダだけが見たいときに -O/dev/null -S とかね。
</p>



<hr><!-- ____________________________________________________________ -->

<h2><a name="user_agent">--user-agent=DoCoMo/1.0/F502i</a></h2>

<p>
        ユーザーエージェントの指定。
</p>
<p>
        上の例なら i-mode のふり。
        または、--user-agent='Mozilla/4.06 [en] (Win95; I)' とか。
</p>


<hr><!-- ____________________________________________________________ -->

<h2><a name="http_user">--http-user=ginza5432 --http-passwd=xxxx</a></h2>

<p>
        ユーザー名／パスワードを指定。
</p>
<p>
        http://user:passwd@host/ みたいなURLを GET するより、
        このオプションを使った方がいいと思う。
        サーバとしゃべる時にはリクエストヘッダに書かれる情報なんだし、
        妙なURLを書くとURLエンコーディングの関係で面倒かもしれないから。
</p>


<hr><!-- ____________________________________________________________ -->

<h2><a name="FAQ">FAQ（その他）</a></h2>

<p>
        Q: レスポンスへッダが-Sで見られるのはいいのですが、
        リクエストへッダを見るオプションはないのですか？
</p>
<p>
        A: ないです。
        どうしても見てみたかったら、
        -dでデバッグログを出せば、なんとか見られます。
</p>

<address>
hanawa <a href="mailto:y@hnw.jp">&lt;y@hnw.jp&gt;</a>
</address>
<p class="date">
$Date: 2004-05-14 07:28:00 $
</p>

<hr><!-- ____________________________________________________________ -->

<p class="footer">
<a href="../../index.html">[home]</a>
<a href="./index.html">[back]</a>
</p>

</body>
</html>
